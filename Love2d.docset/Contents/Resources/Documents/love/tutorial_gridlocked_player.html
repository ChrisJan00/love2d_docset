<html class="client-nojs" dir="ltr" lang="en">
  <head>
    <meta charset="UTF-8"/>
    <title>Tutorial:Gridlocked Player - LOVE</title>
    <meta content="MediaWiki 1.24.2" name="generator"/>
    <link href="" rel="ExportRDF" title="Tutorial:Gridlocked Player" type="application/rdf+xml"/>
    <link href="favicon.ico" rel="shortcut icon"/>
    <link href="opensearch_desc.php" rel="search" title="LOVE (en)" type="application/opensearchdescription+xml"/>
    <link href="api.php_action_rsd" rel="EditURI" type="application/rsd+xml"/>
    <link href="" hreflang="x-default" rel="alternate"/>
    <link href="http://www.gnu.org/copyleft/fdl.html" rel="copyright"/>
    <link href="" rel="alternate" title="LOVE Atom feed" type="application/atom+xml"/>
    <link href="love_wiki_style.css" rel="stylesheet"/>
    <meta content="" name="ResourceLoaderDynamicStyles"/>
    <style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: love2d_wiki:resourceloader:filter:minify-css:7:daf253d59690fd9cabb6b95510bce103 */</style>
  </head>
  <body class="mediawiki ltr sitedir-ltr ns-500 ns-subject page-Tutorial_Gridlocked_Player skin-love action-view">
    <div id="globalWrapper">
      <div id="column-content">
        <div class="mw-body" id="content" role="main">
          <h1 class="firstHeading" id="firstHeading" lang="en">Tutorial:Gridlocked Player</h1>
          <div id="bodyContent">
            <div class="mw-content-ltr" dir="ltr" id="mw-content-text" lang="en">
              <p>In this tutorial, we will create a VERY basic game wherein you can move a "player" around the screen in fixed increments, but the player graphic moves in smaller increments. This could be useful if you are creating a game that is tile-based, and want your player to stay aligned to the grid, but don't want them to appear to teleport around.
</p>
              <h2>
                <span class="mw-headline" id="Starting_Code">Starting Code</span>
              </h2>
              <p>To start with, we need to create a player. The player will have several aspects before we're done, so we're going to make the player variable a table inside of <a href="love47.html" title="love.load">love.load</a>().
</p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="lua source-lua">
                  <pre class="de1"><span class="kw1">function</span> love<span class="sy0">.</span>load<span class="br0">(</span><span class="br0">)</span>
	player <span class="sy0">=</span> <span class="br0">{</span><span class="br0">}</span>
<span class="kw1">end</span></pre>
                </div>
              </div>
              <p>Next we'll need to see what we're doing. We can render the player as a rectangle using <a href="love.graphics123.html" title="love.graphics.rectangle">love.graphics.rectangle</a>() in <a href="love49.html" title="love.draw">love.draw</a>().
</p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="lua source-lua">
                  <pre class="de1"><span class="kw1">function</span> love<span class="sy0">.</span>draw<span class="br0">(</span><span class="br0">)</span>
	love<span class="sy0">.</span>graphics<span class="sy0">.</span>rectangle<span class="br0">(</span><span class="st0">"fill"</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">32</span><span class="sy0">,</span> <span class="nu0">32</span><span class="br0">)</span>
<span class="kw1">end</span></pre>
                </div>
              </div>
              <p>Let's fill in the player table a little so that the player has a position. Note that we're using the shorthand way of putting variables into a table: just define them inside the curly brackets, using commas to separate them. (We also need to change the parameters in love.graphics.rectangle to use these new values.)
</p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="lua source-lua">
                  <pre class="de1"><span class="kw1">function</span> love<span class="sy0">.</span>load<span class="br0">(</span><span class="br0">)</span>
	player <span class="sy0">=</span> <span class="br0">{</span>
		x <span class="sy0">=</span> <span class="nu0">256</span><span class="sy0">,</span>
		y <span class="sy0">=</span> <span class="nu0">256</span>
	<span class="br0">}</span>
<span class="kw1">end</span>
&#xA0;
<span class="kw1">function</span> love<span class="sy0">.</span>draw<span class="br0">(</span><span class="br0">)</span>
	love<span class="sy0">.</span>graphics<span class="sy0">.</span>rectangle<span class="br0">(</span><span class="st0">"fill"</span><span class="sy0">,</span> player<span class="sy0">.</span>x<span class="sy0">,</span> player<span class="sy0">.</span>y<span class="sy0">,</span> <span class="nu0">32</span><span class="sy0">,</span> <span class="nu0">32</span><span class="br0">)</span>
<span class="kw1">end</span></pre>
                </div>
              </div>
              <p>
                <img alt="Grid player 1.gif" height="600" src="grid_player_1.gif" width="800"/>
              </p>
              <p>Now that the player has position, let's add in some controls using <a href="love27.html" title="love.keypressed">love.keypressed</a>(). All we do is check to see if the key matches, and change the value in the player table.
</p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="lua source-lua">
                  <pre class="de1"><span class="kw1">function</span> love<span class="sy0">.</span>keypressed<span class="br0">(</span>key<span class="br0">)</span>
	<span class="kw1">if</span> key <span class="sy0">==</span> <span class="st0">"down"</span> <span class="kw1">then</span>
		player<span class="sy0">.</span>y <span class="sy0">=</span> player<span class="sy0">.</span>y <span class="sy0">+</span> <span class="nu0">32</span>
	<span class="kw1">end</span>
<span class="kw1">end</span></pre>
                </div>
              </div>
              <p>So we now have a little square that can teleport down by one grid unit (32 pixels in our case, the same length that we made our player).
</p>
              <h2>
                <span class="mw-headline" id="Expansion">Expansion</span>
              </h2>
              <p>We can expand this to more keys using elseif. Notice that everything is still in units of 32, a common tile size that plays nice with <a href="po2_syndrome.html" title="PO2 Syndrome">PO2_Syndrome</a>.
</p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="lua source-lua">
                  <pre class="de1"><span class="kw1">function</span> love<span class="sy0">.</span>keypressed<span class="br0">(</span>key<span class="br0">)</span>
	<span class="kw1">if</span> key <span class="sy0">==</span> <span class="st0">"up"</span> <span class="kw1">then</span>
		player<span class="sy0">.</span>y <span class="sy0">=</span> player<span class="sy0">.</span>y <span class="sy0">-</span> <span class="nu0">32</span>
	<span class="kw1">elseif</span> key <span class="sy0">==</span> <span class="st0">"down"</span> <span class="kw1">then</span>
		player<span class="sy0">.</span>y <span class="sy0">=</span> player<span class="sy0">.</span>y <span class="sy0">+</span> <span class="nu0">32</span>
	<span class="kw1">elseif</span> key <span class="sy0">==</span> <span class="st0">"left"</span> <span class="kw1">then</span>
		player<span class="sy0">.</span>x <span class="sy0">=</span> player<span class="sy0">.</span>x <span class="sy0">-</span> <span class="nu0">32</span>
	<span class="kw1">elseif</span> key <span class="sy0">==</span> <span class="st0">"right"</span> <span class="kw1">then</span>
		player<span class="sy0">.</span>x <span class="sy0">=</span> player<span class="sy0">.</span>x <span class="sy0">+</span> <span class="nu0">32</span>
	<span class="kw1">end</span>
<span class="kw1">end</span></pre>
                </div>
              </div>
              <p>So we now have a happy little square that can jump around the screen as fast as you can hit the keyboard. Now let's add in the smooth transitions. To do this, we're going to need to shift up the variables in the player table. Don't forget that this will affect all references to the player table.
</p>
              <p>There are two things that we will now need. One, we need actual XY coordinates as opposed to the gridlocked coordinates that will now serve as destination coordinates. Two, we need to update the actual coordinates in love.update() to move towards the destination coordinates. We can do that with a simple math problem: 
</p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="lua source-lua">
                  <pre class="de1">actual_x <span class="sy0">=</span> actual_x <span class="sy0">-</span> <span class="br0">(</span>actual_x <span class="sy0">-</span> destination_x<span class="br0">)</span></pre>
                </div>
              </div>
              <p>Or, in real Lua this time:
</p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="lua source-lua">
                  <pre class="de1"><span class="kw1">function</span> love<span class="sy0">.</span>load<span class="br0">(</span><span class="br0">)</span>
	player <span class="sy0">=</span> <span class="br0">{</span>
		grid_x <span class="sy0">=</span> <span class="nu0">256</span><span class="sy0">,</span>
		grid_y <span class="sy0">=</span> <span class="nu0">256</span><span class="sy0">,</span>
		act_x <span class="sy0">=</span> <span class="nu0">200</span><span class="sy0">,</span>
		act_y <span class="sy0">=</span> <span class="nu0">200</span>
	<span class="br0">}</span>
<span class="kw1">end</span>
&#xA0;
<span class="kw1">function</span> love<span class="sy0">.</span>update<span class="br0">(</span>dt<span class="br0">)</span>
	player<span class="sy0">.</span>act_y <span class="sy0">=</span> player<span class="sy0">.</span>act_y <span class="sy0">-</span> <span class="br0">(</span>player<span class="sy0">.</span>act_y <span class="sy0">-</span> player<span class="sy0">.</span>grid_y<span class="br0">)</span>
	player<span class="sy0">.</span>act_x <span class="sy0">=</span> player<span class="sy0">.</span>act_x <span class="sy0">-</span> <span class="br0">(</span>player<span class="sy0">.</span>act_x <span class="sy0">-</span> player<span class="sy0">.</span>grid_x<span class="br0">)</span>
<span class="kw1">end</span>
&#xA0;
<span class="kw1">function</span> love<span class="sy0">.</span>draw<span class="br0">(</span><span class="br0">)</span>
	love<span class="sy0">.</span>graphics<span class="sy0">.</span>rectangle<span class="br0">(</span><span class="st0">"fill"</span><span class="sy0">,</span> player<span class="sy0">.</span>act_x<span class="sy0">,</span> player<span class="sy0">.</span>act_y<span class="sy0">,</span> <span class="nu0">32</span><span class="sy0">,</span> <span class="nu0">32</span><span class="br0">)</span>
<span class="kw1">end</span>
&#xA0;
<span class="kw1">function</span> love<span class="sy0">.</span>keypressed<span class="br0">(</span>key<span class="br0">)</span>
	<span class="kw1">if</span> key <span class="sy0">==</span> <span class="st0">"up"</span> <span class="kw1">then</span>
		player<span class="sy0">.</span>grid_y <span class="sy0">=</span> player<span class="sy0">.</span>grid_y <span class="sy0">-</span> <span class="nu0">32</span>
	<span class="kw1">elseif</span> key <span class="sy0">==</span> <span class="st0">"down"</span> <span class="kw1">then</span>
		player<span class="sy0">.</span>grid_y <span class="sy0">=</span> player<span class="sy0">.</span>grid_y <span class="sy0">+</span> <span class="nu0">32</span>
	<span class="kw1">elseif</span> key <span class="sy0">==</span> <span class="st0">"left"</span> <span class="kw1">then</span>
		player<span class="sy0">.</span>grid_x <span class="sy0">=</span> player<span class="sy0">.</span>grid_x <span class="sy0">-</span> <span class="nu0">32</span>
	<span class="kw1">elseif</span> key <span class="sy0">==</span> <span class="st0">"right"</span> <span class="kw1">then</span>
		player<span class="sy0">.</span>grid_x <span class="sy0">=</span> player<span class="sy0">.</span>grid_x <span class="sy0">+</span> <span class="nu0">32</span>
	<span class="kw1">end</span>
<span class="kw1">end</span></pre>
                </div>
              </div>
              <p>As you probably noticed, you probably can't see any difference. We need to use <a href="love48.html" title="love.update">love.update</a>'s <a href="dt.html" title="dt">dt</a> parameter to control speed, by multiplying the difference of the positions by dt:
</p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="lua source-lua">
                  <pre class="de1"><span class="kw1">function</span> love<span class="sy0">.</span>update<span class="br0">(</span>dt<span class="br0">)</span>
	player<span class="sy0">.</span>act_y <span class="sy0">=</span> player<span class="sy0">.</span>act_y <span class="sy0">-</span> <span class="br0">(</span><span class="br0">(</span>player<span class="sy0">.</span>act_y <span class="sy0">-</span> player<span class="sy0">.</span>grid_y<span class="br0">)</span> <span class="sy0">*</span> dt<span class="br0">)</span>
	player<span class="sy0">.</span>act_x <span class="sy0">=</span> player<span class="sy0">.</span>act_x <span class="sy0">-</span> <span class="br0">(</span><span class="br0">(</span>player<span class="sy0">.</span>act_x <span class="sy0">-</span> player<span class="sy0">.</span>grid_x<span class="br0">)</span> <span class="sy0">*</span> dt<span class="br0">)</span>
<span class="kw1">end</span></pre>
                </div>
              </div>
              <p>Still not quite right though. Now the player is unbearably slow (but at least he's consistent from computer to computer!). Let's give the player a speed attribute to control how fast he moves, by multiplying dt by the speed:
</p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="lua source-lua">
                  <pre class="de1"><span class="kw1">function</span> love<span class="sy0">.</span>load<span class="br0">(</span><span class="br0">)</span>
	player <span class="sy0">=</span> <span class="br0">{</span>
		grid_x <span class="sy0">=</span> <span class="nu0">256</span><span class="sy0">,</span>
		grid_y <span class="sy0">=</span> <span class="nu0">256</span><span class="sy0">,</span>
		act_x <span class="sy0">=</span> <span class="nu0">200</span><span class="sy0">,</span>
		act_y <span class="sy0">=</span> <span class="nu0">200</span><span class="sy0">,</span>
		speed <span class="sy0">=</span> <span class="nu0">10</span>
	<span class="br0">}</span>
<span class="kw1">end</span>
&#xA0;
<span class="kw1">function</span> love<span class="sy0">.</span>update<span class="br0">(</span>dt<span class="br0">)</span>
	player<span class="sy0">.</span>act_y <span class="sy0">=</span> player<span class="sy0">.</span>act_y <span class="sy0">-</span> <span class="br0">(</span><span class="br0">(</span>player<span class="sy0">.</span>act_y <span class="sy0">-</span> player<span class="sy0">.</span>grid_y<span class="br0">)</span> <span class="sy0">*</span> player<span class="sy0">.</span>speed <span class="sy0">*</span> dt<span class="br0">)</span>
	player<span class="sy0">.</span>act_x <span class="sy0">=</span> player<span class="sy0">.</span>act_x <span class="sy0">-</span> <span class="br0">(</span><span class="br0">(</span>player<span class="sy0">.</span>act_x <span class="sy0">-</span> player<span class="sy0">.</span>grid_x<span class="br0">)</span> <span class="sy0">*</span> player<span class="sy0">.</span>speed <span class="sy0">*</span> dt<span class="br0">)</span>
<span class="kw1">end</span></pre>
                </div>
              </div>
              <h2>
                <span class="mw-headline" id="Putting_it_all_together">Putting it all together</span>
              </h2>
              <p>Here is the full code:
</p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="lua source-lua">
                  <pre class="de1"><span class="kw1">function</span> love<span class="sy0">.</span>load<span class="br0">(</span><span class="br0">)</span>
	player <span class="sy0">=</span> <span class="br0">{</span>
		grid_x <span class="sy0">=</span> <span class="nu0">256</span><span class="sy0">,</span>
		grid_y <span class="sy0">=</span> <span class="nu0">256</span><span class="sy0">,</span>
		act_x <span class="sy0">=</span> <span class="nu0">200</span><span class="sy0">,</span>
		act_y <span class="sy0">=</span> <span class="nu0">200</span><span class="sy0">,</span>
		speed <span class="sy0">=</span> <span class="nu0">10</span>
	<span class="br0">}</span>
<span class="kw1">end</span>
&#xA0;
<span class="kw1">function</span> love<span class="sy0">.</span>update<span class="br0">(</span>dt<span class="br0">)</span>
	player<span class="sy0">.</span>act_y <span class="sy0">=</span> player<span class="sy0">.</span>act_y <span class="sy0">-</span> <span class="br0">(</span><span class="br0">(</span>player<span class="sy0">.</span>act_y <span class="sy0">-</span> player<span class="sy0">.</span>grid_y<span class="br0">)</span> <span class="sy0">*</span> player<span class="sy0">.</span>speed <span class="sy0">*</span> dt<span class="br0">)</span>
	player<span class="sy0">.</span>act_x <span class="sy0">=</span> player<span class="sy0">.</span>act_x <span class="sy0">-</span> <span class="br0">(</span><span class="br0">(</span>player<span class="sy0">.</span>act_x <span class="sy0">-</span> player<span class="sy0">.</span>grid_x<span class="br0">)</span> <span class="sy0">*</span> player<span class="sy0">.</span>speed <span class="sy0">*</span> dt<span class="br0">)</span>
<span class="kw1">end</span>
&#xA0;
<span class="kw1">function</span> love<span class="sy0">.</span>draw<span class="br0">(</span><span class="br0">)</span>
	love<span class="sy0">.</span>graphics<span class="sy0">.</span>rectangle<span class="br0">(</span><span class="st0">"fill"</span><span class="sy0">,</span> player<span class="sy0">.</span>act_x<span class="sy0">,</span> player<span class="sy0">.</span>act_y<span class="sy0">,</span> <span class="nu0">32</span><span class="sy0">,</span> <span class="nu0">32</span><span class="br0">)</span>
<span class="kw1">end</span>
&#xA0;
<span class="kw1">function</span> love<span class="sy0">.</span>keypressed<span class="br0">(</span>key<span class="br0">)</span>
	<span class="kw1">if</span> key <span class="sy0">==</span> <span class="st0">"up"</span> <span class="kw1">then</span>
		player<span class="sy0">.</span>grid_y <span class="sy0">=</span> player<span class="sy0">.</span>grid_y <span class="sy0">-</span> <span class="nu0">32</span>
	<span class="kw1">elseif</span> key <span class="sy0">==</span> <span class="st0">"down"</span> <span class="kw1">then</span>
		player<span class="sy0">.</span>grid_y <span class="sy0">=</span> player<span class="sy0">.</span>grid_y <span class="sy0">+</span> <span class="nu0">32</span>
	<span class="kw1">elseif</span> key <span class="sy0">==</span> <span class="st0">"left"</span> <span class="kw1">then</span>
		player<span class="sy0">.</span>grid_x <span class="sy0">=</span> player<span class="sy0">.</span>grid_x <span class="sy0">-</span> <span class="nu0">32</span>
	<span class="kw1">elseif</span> key <span class="sy0">==</span> <span class="st0">"right"</span> <span class="kw1">then</span>
		player<span class="sy0">.</span>grid_x <span class="sy0">=</span> player<span class="sy0">.</span>grid_x <span class="sy0">+</span> <span class="nu0">32</span>
	<span class="kw1">end</span>
<span class="kw1">end</span></pre>
                </div>
              </div>
              <h2>
                <span class="mw-headline" id="Adding_collision">Adding collision</span>
              </h2>
              <p>Now let's add some world detail. To start with, we need to create a table of values that will dictate whether we can walk onto a grid or not.
</p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="lua source-lua">
                  <pre class="de1"><span class="kw1">function</span> love<span class="sy0">.</span>load<span class="br0">(</span><span class="br0">)</span>
map <span class="sy0">=</span> <span class="br0">{</span>
	<span class="br0">{</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span> <span class="br0">}</span><span class="sy0">,</span>
	<span class="br0">{</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span> <span class="br0">}</span><span class="sy0">,</span>
	<span class="br0">{</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span> <span class="br0">}</span><span class="sy0">,</span>
	<span class="br0">{</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span> <span class="br0">}</span>
<span class="br0">}</span>
<span class="kw1">end</span></pre>
                </div>
              </div>
              <p>This map table holds four subtables, each of which holds four values. Each subtable is a horizontal row in the map, with each value representing a single tile in that row. We used 1s and 0s because they're easy to type.
</p>
              <p>Now let's draw these values to the screen. Since we only have two types, we can get away with just drawing one of the types... let's say the 1s. We loop through the subtables by using a simple for loop, and then loop through the values inside each subtable.
</p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="lua source-lua">
                  <pre class="de1"><span class="kw1">function</span> love<span class="sy0">.</span>draw<span class="br0">(</span><span class="br0">)</span>
	<span class="kw1">for</span> y<span class="sy0">=</span><span class="nu0">1</span><span class="sy0">,</span> <span class="sy0">#</span>map <span class="kw1">do</span>
		<span class="kw1">for</span> x<span class="sy0">=</span><span class="nu0">1</span><span class="sy0">,</span> <span class="sy0">#</span>map<span class="br0">[</span>y<span class="br0">]</span> <span class="kw1">do</span>
			<span class="kw1">if</span> map<span class="br0">[</span>y<span class="br0">]</span><span class="br0">[</span>x<span class="br0">]</span> <span class="sy0">==</span> <span class="nu0">1</span> <span class="kw1">then</span>
				love<span class="sy0">.</span>graphics<span class="sy0">.</span>rectangle<span class="br0">(</span><span class="st0">"line"</span><span class="sy0">,</span> x <span class="sy0">*</span> <span class="nu0">32</span><span class="sy0">,</span> y <span class="sy0">*</span> <span class="nu0">32</span><span class="sy0">,</span> <span class="nu0">32</span><span class="sy0">,</span> <span class="nu0">32</span><span class="br0">)</span>
			<span class="kw1">end</span>
		<span class="kw1">end</span>
	<span class="kw1">end</span>
<span class="kw1">end</span></pre>
                </div>
              </div>
              <p>A couple things to note about this double loop. The map table is arranged the way that we will see it. This means that are coordinates are flipped from how we usually think... instead of being x and then y, the map is y and then x. Also, the map is in units of 32 (one player width). That means that when we draw the unwalkable squares, we have to multiply their positions by 32.
</p>
              <p>
                <img alt="Grid player 2.gif" height="600" src="grid_player_2.gif" width="800"/>
              </p>
              <p>Now let's make a function to test if the player can walk over a spot on our map. This function will return true if we can walk over the spot, and false if we cannot. The function will be given two values: our change in x and our change in y. 
</p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="lua source-lua">
                  <pre class="de1"><span class="kw1">function</span> testMap<span class="br0">(</span>x<span class="sy0">,</span> y<span class="br0">)</span>
	<span class="kw1">if</span> map<span class="br0">[</span><span class="br0">(</span>player<span class="sy0">.</span>grid_y <span class="sy0">/</span> <span class="nu0">32</span><span class="br0">)</span> <span class="sy0">+</span> y<span class="br0">]</span><span class="br0">[</span><span class="br0">(</span>player<span class="sy0">.</span>grid_x <span class="sy0">/</span> <span class="nu0">32</span><span class="br0">)</span> <span class="sy0">+</span> x<span class="br0">]</span> <span class="sy0">==</span> <span class="nu0">1</span> <span class="kw1">then</span>
		<span class="kw1">return</span> <span class="kw4">false</span>
	<span class="kw1">end</span>
	<span class="kw1">return</span> <span class="kw4">true</span>
<span class="kw1">end</span></pre>
                </div>
              </div>
              <p>Things to note about this function. Since we're working in map units, the values passed in will usually just be 1, -1, or 0. That's why they are not divided by 32, unlike the player grid coordinates.
</p>
              <p>Speaking of the player grid coordinates, the reason we did not have to pass those in is because the player is a global variable. 
</p>
              <p>So now we can put this function into use by sticking it in the keypressed function. Remember, the test function works in map units, rather than pixel units, so if we're trying to move up one grid, we pass (0, -1).
</p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="lua source-lua">
                  <pre class="de1"><span class="kw1">function</span> love<span class="sy0">.</span>keypressed<span class="br0">(</span>key<span class="br0">)</span>
	<span class="kw1">if</span> key <span class="sy0">==</span> <span class="st0">"up"</span> <span class="kw1">then</span>
		<span class="kw1">if</span> testMap<span class="br0">(</span><span class="nu0">0</span><span class="sy0">,</span> <span class="sy0">-</span><span class="nu0">1</span><span class="br0">)</span> <span class="kw1">then</span>
			player<span class="sy0">.</span>grid_y <span class="sy0">=</span> player<span class="sy0">.</span>grid_y <span class="sy0">-</span> <span class="nu0">32</span>
		<span class="kw1">end</span>
	<span class="kw1">elseif</span> key <span class="sy0">==</span> <span class="st0">"down"</span> <span class="kw1">then</span>
		<span class="kw1">if</span> testMap<span class="br0">(</span><span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span><span class="br0">)</span> <span class="kw1">then</span>
			player<span class="sy0">.</span>grid_y <span class="sy0">=</span> player<span class="sy0">.</span>grid_y <span class="sy0">+</span> <span class="nu0">32</span>
		<span class="kw1">end</span>
	<span class="kw1">elseif</span> key <span class="sy0">==</span> <span class="st0">"left"</span> <span class="kw1">then</span>
		<span class="kw1">if</span> testMap<span class="br0">(</span><span class="sy0">-</span><span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="br0">)</span> <span class="kw1">then</span>
			player<span class="sy0">.</span>grid_x <span class="sy0">=</span> player<span class="sy0">.</span>grid_x <span class="sy0">-</span> <span class="nu0">32</span>
		<span class="kw1">end</span>
	<span class="kw1">elseif</span> key <span class="sy0">==</span> <span class="st0">"right"</span> <span class="kw1">then</span>
		<span class="kw1">if</span> testMap<span class="br0">(</span><span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="br0">)</span> <span class="kw1">then</span>
			player<span class="sy0">.</span>grid_x <span class="sy0">=</span> player<span class="sy0">.</span>grid_x <span class="sy0">+</span> <span class="nu0">32</span>
		<span class="kw1">end</span>
	<span class="kw1">end</span>
<span class="kw1">end</span></pre>
                </div>
              </div>
              <p>You may have noticed that if you try to run this now, the program crashes. This is because our player starts outside of our map. If we expand the map we can fix the bug. Here is the full code with the expanded map.
</p>
              <div class="mw-geshi mw-code mw-content-ltr" dir="ltr">
                <div class="lua source-lua">
                  <pre class="de1"><span class="kw1">function</span> love<span class="sy0">.</span>load<span class="br0">(</span><span class="br0">)</span>
	player <span class="sy0">=</span> <span class="br0">{</span>
		grid_x <span class="sy0">=</span> <span class="nu0">256</span><span class="sy0">,</span>
		grid_y <span class="sy0">=</span> <span class="nu0">256</span><span class="sy0">,</span>
		act_x <span class="sy0">=</span> <span class="nu0">200</span><span class="sy0">,</span>
		act_y <span class="sy0">=</span> <span class="nu0">200</span><span class="sy0">,</span>
		speed <span class="sy0">=</span> <span class="nu0">10</span>
	<span class="br0">}</span>
	map <span class="sy0">=</span> <span class="br0">{</span>
		<span class="br0">{</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span> <span class="br0">}</span><span class="sy0">,</span>
		<span class="br0">{</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span> <span class="br0">}</span><span class="sy0">,</span>
		<span class="br0">{</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span> <span class="br0">}</span><span class="sy0">,</span>
		<span class="br0">{</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span> <span class="br0">}</span><span class="sy0">,</span>
		<span class="br0">{</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span> <span class="br0">}</span><span class="sy0">,</span>
		<span class="br0">{</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span> <span class="br0">}</span><span class="sy0">,</span>
		<span class="br0">{</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span> <span class="br0">}</span><span class="sy0">,</span>
		<span class="br0">{</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span> <span class="br0">}</span><span class="sy0">,</span>
		<span class="br0">{</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span> <span class="br0">}</span><span class="sy0">,</span>
		<span class="br0">{</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span> <span class="br0">}</span><span class="sy0">,</span>
		<span class="br0">{</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span> <span class="br0">}</span><span class="sy0">,</span>
		<span class="br0">{</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span> <span class="br0">}</span><span class="sy0">,</span>
		<span class="br0">{</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">1</span> <span class="br0">}</span>
	<span class="br0">}</span>
<span class="kw1">end</span>
&#xA0;
<span class="kw1">function</span> love<span class="sy0">.</span>update<span class="br0">(</span>dt<span class="br0">)</span>
	player<span class="sy0">.</span>act_y <span class="sy0">=</span> player<span class="sy0">.</span>act_y <span class="sy0">-</span> <span class="br0">(</span><span class="br0">(</span>player<span class="sy0">.</span>act_y <span class="sy0">-</span> player<span class="sy0">.</span>grid_y<span class="br0">)</span> <span class="sy0">*</span> player<span class="sy0">.</span>speed <span class="sy0">*</span> dt<span class="br0">)</span>
	player<span class="sy0">.</span>act_x <span class="sy0">=</span> player<span class="sy0">.</span>act_x <span class="sy0">-</span> <span class="br0">(</span><span class="br0">(</span>player<span class="sy0">.</span>act_x <span class="sy0">-</span> player<span class="sy0">.</span>grid_x<span class="br0">)</span> <span class="sy0">*</span> player<span class="sy0">.</span>speed <span class="sy0">*</span> dt<span class="br0">)</span>
<span class="kw1">end</span>
&#xA0;
<span class="kw1">function</span> love<span class="sy0">.</span>draw<span class="br0">(</span><span class="br0">)</span>
	love<span class="sy0">.</span>graphics<span class="sy0">.</span>rectangle<span class="br0">(</span><span class="st0">"fill"</span><span class="sy0">,</span> player<span class="sy0">.</span>act_x<span class="sy0">,</span> player<span class="sy0">.</span>act_y<span class="sy0">,</span> <span class="nu0">32</span><span class="sy0">,</span> <span class="nu0">32</span><span class="br0">)</span>
	<span class="kw1">for</span> y<span class="sy0">=</span><span class="nu0">1</span><span class="sy0">,</span> <span class="sy0">#</span>map <span class="kw1">do</span>
		<span class="kw1">for</span> x<span class="sy0">=</span><span class="nu0">1</span><span class="sy0">,</span> <span class="sy0">#</span>map<span class="br0">[</span>y<span class="br0">]</span> <span class="kw1">do</span>
			<span class="kw1">if</span> map<span class="br0">[</span>y<span class="br0">]</span><span class="br0">[</span>x<span class="br0">]</span> <span class="sy0">==</span> <span class="nu0">1</span> <span class="kw1">then</span>
				love<span class="sy0">.</span>graphics<span class="sy0">.</span>rectangle<span class="br0">(</span><span class="st0">"line"</span><span class="sy0">,</span> x <span class="sy0">*</span> <span class="nu0">32</span><span class="sy0">,</span> y <span class="sy0">*</span> <span class="nu0">32</span><span class="sy0">,</span> <span class="nu0">32</span><span class="sy0">,</span> <span class="nu0">32</span><span class="br0">)</span>
			<span class="kw1">end</span>
		<span class="kw1">end</span>
	<span class="kw1">end</span>
<span class="kw1">end</span>
&#xA0;
<span class="kw1">function</span> love<span class="sy0">.</span>keypressed<span class="br0">(</span>key<span class="br0">)</span>
	<span class="kw1">if</span> key <span class="sy0">==</span> <span class="st0">"up"</span> <span class="kw1">then</span>
		<span class="kw1">if</span> testMap<span class="br0">(</span><span class="nu0">0</span><span class="sy0">,</span> <span class="sy0">-</span><span class="nu0">1</span><span class="br0">)</span> <span class="kw1">then</span>
			player<span class="sy0">.</span>grid_y <span class="sy0">=</span> player<span class="sy0">.</span>grid_y <span class="sy0">-</span> <span class="nu0">32</span>
		<span class="kw1">end</span>
	<span class="kw1">elseif</span> key <span class="sy0">==</span> <span class="st0">"down"</span> <span class="kw1">then</span>
		<span class="kw1">if</span> testMap<span class="br0">(</span><span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">1</span><span class="br0">)</span> <span class="kw1">then</span>
			player<span class="sy0">.</span>grid_y <span class="sy0">=</span> player<span class="sy0">.</span>grid_y <span class="sy0">+</span> <span class="nu0">32</span>
		<span class="kw1">end</span>
	<span class="kw1">elseif</span> key <span class="sy0">==</span> <span class="st0">"left"</span> <span class="kw1">then</span>
		<span class="kw1">if</span> testMap<span class="br0">(</span><span class="sy0">-</span><span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="br0">)</span> <span class="kw1">then</span>
			player<span class="sy0">.</span>grid_x <span class="sy0">=</span> player<span class="sy0">.</span>grid_x <span class="sy0">-</span> <span class="nu0">32</span>
		<span class="kw1">end</span>
	<span class="kw1">elseif</span> key <span class="sy0">==</span> <span class="st0">"right"</span> <span class="kw1">then</span>
		<span class="kw1">if</span> testMap<span class="br0">(</span><span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="br0">)</span> <span class="kw1">then</span>
			player<span class="sy0">.</span>grid_x <span class="sy0">=</span> player<span class="sy0">.</span>grid_x <span class="sy0">+</span> <span class="nu0">32</span>
		<span class="kw1">end</span>
	<span class="kw1">end</span>
<span class="kw1">end</span>
&#xA0;
<span class="kw1">function</span> testMap<span class="br0">(</span>x<span class="sy0">,</span> y<span class="br0">)</span>
	<span class="kw1">if</span> map<span class="br0">[</span><span class="br0">(</span>player<span class="sy0">.</span>grid_y <span class="sy0">/</span> <span class="nu0">32</span><span class="br0">)</span> <span class="sy0">+</span> y<span class="br0">]</span><span class="br0">[</span><span class="br0">(</span>player<span class="sy0">.</span>grid_x <span class="sy0">/</span> <span class="nu0">32</span><span class="br0">)</span> <span class="sy0">+</span> x<span class="br0">]</span> <span class="sy0">==</span> <span class="nu0">1</span> <span class="kw1">then</span>
		<span class="kw1">return</span> <span class="kw4">false</span>
	<span class="kw1">end</span>
	<span class="kw1">return</span> <span class="kw4">true</span>
<span class="kw1">end</span></pre>
                </div>
              </div>
              <p>
                <img alt="Grid player 3.gif" height="600" src="grid_player_3.gif" width="800"/>
              </p>
              <p>There are several ways this could be improved. 
</p>
              <ul>
                <li> The art could be touched up, of course, using the techniques covered in this article: <a class="external autonumber" href="http://tommybrunn.com/2011/01/how-to-make-placeholder-art/" rel="nofollow">[1]</a> </li>
                <li> We could also implement some extra controls, such as binding the Escape key to <a href="love.event9.html" title="love.event.push">love.event.push</a>('quit'), which would quit the game. </li>
                <li> The player is inside of a closed map, but if the map was open and the player tried to leave it, the game would crash. We could easily add some checks to prevent this from happening.</li>
                <li> The map starts off at 32,32 when it would make more sense for it to start at 0,0. A little bit of arithmetic could fix this pretty easily, but it does make the code a bit more complex and hard to follow.</li>
              </ul>
              <p>But for the purposes of this tutorial we have enough already.
</p>
              <p>
                <br/>
              </p>
            </div>
            <div class="catlinks" id="catlinks">
              <div class="mw-normal-catlinks" id="mw-normal-catlinks"><em>Category</em>: <ul><li><a href="category_tutorials.html" title="Category:Tutorials">Tutorials</a></li></ul></div>
            </div>
            <div class="visualClear"/>
          </div>
        </div>
      </div>
      <div class="visualClear"/>
      <div id="footer" role="contentinfo">
        <ul id="f-list">
          <li id="copyright">Content is available under <a class="external" href="http://www.gnu.org/copyleft/fdl.html" rel="nofollow">GNU Free Documentation License 1.3</a> unless otherwise noted.</li>
        </ul>
      </div>
    </div>
  </body>
</html>
